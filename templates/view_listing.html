{% extends "layout.html" %}

{% block title %}: {{ listing.title }}{% endblock %}

{% block main %}

    <div class="container py-5">
        <div class="row align-items-center">
            <!-- Text Content -->
            <div class="col-md-6">
                <h1 class="fw-bold">{{ listing.title }}</h1>
                <p class="text-muted">{{ listing.description }}</p>
                <h3 class="text-primary fw-bold">{{ listing.price }}à§³</h3>
                <p><strong>Tag:</strong><a href="/tag/{{ listing.tag }}"> {{ listing.tag }} </a></p>

                <!--Time-->
                <p><strong>Auction End Time:</strong> <span id="auction-end-time">{{ listing.auction_end_time }}</span></p>
                <p><strong>Remaining Time:</strong> <span id="remaining-time"></span></p>

                <!--Buttons TODO-->
                <div class="mt-3">
                    <a href="/edit_listing/{{ listing.listing_id }}" class="btn btn-primary">Edit Listing</a>
                    <form action="/delete_listing/{{ listing.listing_id }}" method="post" class="d-inline">
                        <button type="submit" class="btn btn-danger">Delete Listing</button>
                    </form>
                    <a href="/bid/{{ listing.listing_id }}" class="btn btn-success">Bid on Listing</a>
                </div>

            </div>

            <!-- Image Content -->
            <div class="col-md-6 text-center">
                <img src="{{ listing.image_url }}" alt="Product Image" class="img-fluid rounded shadow">
            </div>

        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const auctionEndTime = new Date(document.getElementById('auction-end-time').textContent);
        const remainingTimeElement = document.getElementById('remaining-time');

        function updateRemainingTime() {
            const now = new Date();
            const timeDifference = auctionEndTime - now;

            if (timeDifference <= 0) {
                remainingTimeElement.textContent = 'Auction ended';
                clearInterval(timerInterval);
                return;
            }

            const days = Math.floor(timeDifference / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeDifference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeDifference % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeDifference % (1000 * 60)) / 1000);

            remainingTimeElement.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
        }

        const timerInterval = setInterval(updateRemainingTime, 1000);
        updateRemainingTime();
    });
</script>

{% endblock %}
